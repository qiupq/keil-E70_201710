<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SAME70 Xplained Software Package: libraries/liblwip/source/lwip_1.3.2/src/core/ipv4/ip_frag.c File Reference</title>
<link href="common/style.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
    <div id="body">
        <div id="title">  SAME70 Xplained Software Package 1.5</div>
        <div id="banner"></div>

<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="dir_81818f1c1b01098ad6d8389f2aaf9f72.html">libraries</a>      </li>
      <li><a class="el" href="dir_f9d6af8b0767ec29e003eb404f55b2ba.html">liblwip</a>      </li>
      <li><a class="el" href="dir_a4b90551bcebf72d44580c734ab11c86.html">source</a>      </li>
      <li><a class="el" href="dir_7fff4700eae15a55204f316974611e6c.html">lwip_1.3.2</a>      </li>
      <li><a class="el" href="dir_6c5a4da2b38a7354841e985f92489e70.html">src</a>      </li>
      <li><a class="el" href="dir_edf09da46bb12db6367452bd0397000e.html">core</a>      </li>
      <li><a class="el" href="dir_28a0af74defe57bbba20a40c94d34848.html">ipv4</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<h1>ip_frag.c File Reference</h1>  </div>
</div>
<div class="contents">
<code>#include &quot;<a class="el" href="opt_8h_source.html">lwip/opt.h</a>&quot;</code><br/>
<code>#include &quot;lwip/ip_frag.h&quot;</code><br/>
<code>#include &quot;lwip/ip.h&quot;</code><br/>
<code>#include &quot;lwip/inet.h&quot;</code><br/>
<code>#include &quot;lwip/inet_chksum.h&quot;</code><br/>
<code>#include &quot;lwip/netif.h&quot;</code><br/>
<code>#include &quot;lwip/snmp.h&quot;</code><br/>
<code>#include &quot;lwip/stats.h&quot;</code><br/>
<code>#include &quot;lwip/icmp.h&quot;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>

<p><a href="ip__frag_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structip__reass__helper.html">ip_reass_helper</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ip__frag_8c.html#a01f595ac215e7da60fa1937a90558b22">IP_REASS_FLAG_LASTFRAG</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>IP_ADDRESSES_AND_ID_MATCH</b>(iphdrA, iphdrB)</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ip__frag_8c.html#abc7017eb20983f372e81de7376ebec88">ip_reass_tmr</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ip__frag_8c.html#a5752d82db629e96aa78d42eb538dde71">ip_reass</a> (struct <a class="el" href="structpbuf.html">pbuf</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">err_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ip__frag_8c.html#a60810dfd54594e4e2591bfccc48646a6">ip_frag</a> (struct <a class="el" href="structpbuf.html">pbuf</a> *p, struct <a class="el" href="structnetif.html">netif</a> *<a class="el" href="structnetif.html">netif</a>, struct <a class="el" href="structip__addr.html">ip_addr</a> *dest)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">PACK_STRUCT_BEGIN struct <br class="typebreak"/>
<a class="el" href="structip__reass__helper.html">ip_reass_helper</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="ip__frag_8c.html#a421562ab5ea9c1ad7f6e3b7fdc7a9c3e">PACK_STRUCT_STRUCT</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>This is the IPv4 packet segmentation and reassembly implementation. </p>

<p>Definition in file <a class="el" href="ip__frag_8c_source.html">ip_frag.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="af632500479c664a7b3f7c7bb74633857"></a><!-- doxytag: member="ip_frag.c::IP_ADDRESSES_AND_ID_MATCH" ref="af632500479c664a7b3f7c7bb74633857" args="(iphdrA, iphdrB)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IP_ADDRESSES_AND_ID_MATCH</td>
          <td>(</td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname">iphdrA, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname">iphdrB</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">(ip_addr_cmp(&amp;(iphdrA)-&gt;src, &amp;(iphdrB)-&gt;src) &amp;&amp; \
   ip_addr_cmp(&amp;(iphdrA)-&gt;dest, &amp;(iphdrB)-&gt;dest) &amp;&amp; \
   IPH_ID(iphdrA) == IPH_ID(iphdrB)) ? 1 : 0
</pre></div>
<p>Definition at line <a class="el" href="ip__frag_8c_source.html#l00100">100</a> of file <a class="el" href="ip__frag_8c_source.html">ip_frag.c</a>.</p>

</div>
</div>
<a class="anchor" id="a01f595ac215e7da60fa1937a90558b22"></a><!-- doxytag: member="ip_frag.c::IP_REASS_FLAG_LASTFRAG" ref="a01f595ac215e7da60fa1937a90558b22" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IP_REASS_FLAG_LASTFRAG&nbsp;&nbsp;&nbsp;0x01</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The IP reassembly code currently has the following limitations:</p>
<ul>
<li>IP header options are not supported</li>
<li>fragments must not overlap (e.g. due to different routes), currently, overlapping or duplicate fragments are thrown away if IP_REASS_CHECK_OVERLAP=1 (the default)!</li>
</ul>
<p>Setting this to 0, you can turn off checking the fragments for overlapping regions. The code gets a little smaller. Only use this if you know that overlapping won't occur on your network! Set to 0 to prevent freeing the oldest datagram when the reassembly buffer is full (IP_REASS_MAX_PBUFS pbufs are enqueued). The code gets a little smaller. Datagrams will be freed by timeout only. Especially useful when MEMP_NUM_REASSDATA is set to 1, so one datagram can be reassembled at a time, only. </p>

<p>Definition at line <a class="el" href="ip__frag_8c_source.html#l00079">79</a> of file <a class="el" href="ip__frag_8c_source.html">ip_frag.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a60810dfd54594e4e2591bfccc48646a6"></a><!-- doxytag: member="ip_frag.c::ip_frag" ref="a60810dfd54594e4e2591bfccc48646a6" args="(struct pbuf *p, struct netif *netif, struct ip_addr *dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">err_t ip_frag </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structnetif.html">netif</a> *&nbsp;</td>
          <td class="paramname"> <em>netif</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structip__addr.html">ip_addr</a> *&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Fragment an IP datagram if too large for the netif.</p>
<p>Chop the datagram in MTU sized chunks and send them in order by using a fixed size static memory buffer (PBUF_REF) or point PBUF_REFs into p (depending on IP_FRAG_USES_STATIC_BUF).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>p</em>&nbsp;</td><td>ip packet to send </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>netif</em>&nbsp;</td><td>the netif on which to send </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dest</em>&nbsp;</td><td>destination ip address to which to send</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>ERR_OK if sent successfully, err_t otherwise </dd></dl>

<p>Definition at line <a class="el" href="ip__frag_8c_source.html#l00628">628</a> of file <a class="el" href="ip__frag_8c_source.html">ip_frag.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ip__frag_8c_a60810dfd54594e4e2591bfccc48646a6_cgraph.gif" border="0" usemap="#ip__frag_8c_a60810dfd54594e4e2591bfccc48646a6_cgraph" alt=""/></div>
<map name="ip__frag_8c_a60810dfd54594e4e2591bfccc48646a6_cgraph" id="ip__frag_8c_a60810dfd54594e4e2591bfccc48646a6_cgraph">
<area shape="rect" id="node3" href="group__uipconvfunc.html#gaa22b04cac8cf283ca12f028578bebc06" title="htons" alt="" coords="359,5,420,37"/><area shape="rect" id="node5" href="inet_8c.html#a4e817a3825f6d17c4e3a80614f65ac07" title="ntohs" alt="" coords="173,60,235,92"/><area shape="rect" id="node8" href="pbuf_8c.html#acfcb0a2af918658ba0afe36499c65f47" title="pbuf_alloc" alt="" coords="156,117,252,149"/><area shape="rect" id="node14" href="pbuf_8c.html#ab0dd696fb4b6bc65e548944584f1738b" title="pbuf_free" alt="" coords="344,173,435,205"/><area shape="rect" id="node16" href="pbuf_8c.html#a82429084fe29015509c9b4a072707cd4" title="pbuf_cat" alt="" coords="347,285,432,317"/><area shape="rect" id="node18" href="pbuf_8c.html#a831c9a72bda1d3bd4c7b96f5a0e3b891" title="pbuf_chain" alt="" coords="153,331,255,363"/><area shape="rect" id="node23" href="pbuf_8c.html#a9efc1f3148d6c0236e40b41242bda4df" title="pbuf_copy_partial" alt="" coords="128,387,280,419"/><area shape="rect" id="node26" href="pbuf_8c.html#a50abfe830a33a1a47a562febee66015d" title="pbuf_realloc" alt="" coords="149,224,259,256"/><area shape="rect" id="node10" href="mem_8c.html#a932aa40d85b14cb7331625e012d12335" title="mem_malloc" alt="" coords="333,61,445,93"/><area shape="rect" id="node12" href="memp_8c.html#a2b00593d086313c267b54a976bf67aa5" title="memp_malloc" alt="" coords="329,117,449,149"/><area shape="rect" id="node21" href="pbuf_8c.html#a77f6bbd69e45e542014d9c547c7da74e" title="pbuf_ref" alt="" coords="348,341,431,373"/><area shape="rect" id="node28" href="mem_8c.html#a845e247382361be1945535a21ca6d6a1" title="mem_realloc" alt="" coords="332,229,447,261"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a5752d82db629e96aa78d42eb538dde71"></a><!-- doxytag: member="ip_frag.c::ip_reass" ref="a5752d82db629e96aa78d42eb538dde71" args="(struct pbuf *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structpbuf.html">pbuf</a>* ip_reass </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reassembles incoming IP fragments into an IP datagram.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>p</em>&nbsp;</td><td>points to a pbuf chain of the fragment </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>NULL if reassembly is incomplete, ? otherwise </dd></dl>

<p>Definition at line <a class="el" href="ip__frag_8c_source.html#l00469">469</a> of file <a class="el" href="ip__frag_8c_source.html">ip_frag.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="ip__frag_8c_a5752d82db629e96aa78d42eb538dde71_cgraph.gif" border="0" usemap="#ip__frag_8c_a5752d82db629e96aa78d42eb538dde71_cgraph" alt=""/></div>
<map name="ip__frag_8c_a5752d82db629e96aa78d42eb538dde71_cgraph" id="ip__frag_8c_a5752d82db629e96aa78d42eb538dde71_cgraph">
<area shape="rect" id="node3" href="group__uipconvfunc.html#gaa22b04cac8cf283ca12f028578bebc06" title="htons" alt="" coords="517,43,579,75"/><area shape="rect" id="node5" href="ip__frag_8c.html#a60810dfd54594e4e2591bfccc48646a6" title="ip_frag" alt="" coords="160,283,232,315"/><area shape="rect" id="node8" href="inet_8c.html#a4e817a3825f6d17c4e3a80614f65ac07" title="ntohs" alt="" coords="347,43,408,75"/><area shape="rect" id="node13" href="pbuf_8c.html#ab0dd696fb4b6bc65e548944584f1738b" title="pbuf_free" alt="" coords="503,228,593,260"/><area shape="rect" id="node15" href="pbuf_8c.html#a82429084fe29015509c9b4a072707cd4" title="pbuf_cat" alt="" coords="505,469,591,501"/><area shape="rect" id="node28" href="pbuf_8c.html#a949a13a7cfdf9241c9e7b859af1bd15c" title="pbuf_clen" alt="" coords="149,576,243,608"/><area shape="rect" id="node31" href="pbuf_8c.html#a0f81deff4a0e6e8e0ff161a7b9871449" title="pbuf_header" alt="" coords="139,632,253,664"/><area shape="rect" id="node11" href="pbuf_8c.html#acfcb0a2af918658ba0afe36499c65f47" title="pbuf_alloc" alt="" coords="329,256,425,288"/><area shape="rect" id="node17" href="pbuf_8c.html#a831c9a72bda1d3bd4c7b96f5a0e3b891" title="pbuf_chain" alt="" coords="327,469,428,501"/><area shape="rect" id="node20" href="pbuf_8c.html#a9efc1f3148d6c0236e40b41242bda4df" title="pbuf_copy_partial" alt="" coords="301,413,453,445"/><area shape="rect" id="node23" href="pbuf_8c.html#a50abfe830a33a1a47a562febee66015d" title="pbuf_realloc" alt="" coords="323,200,432,232"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abc7017eb20983f372e81de7376ebec88"></a><!-- doxytag: member="ip_frag.c::ip_reass_tmr" ref="abc7017eb20983f372e81de7376ebec88" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ip_reass_tmr </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reassembly timer base function for both NO_SYS == 0 and 1 (!).</p>
<p>Should be called every 1000 msec (defined by IP_TMR_INTERVAL). </p>

<p>Definition at line <a class="el" href="ip__frag_8c_source.html#l00120">120</a> of file <a class="el" href="ip__frag_8c_source.html">ip_frag.c</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a421562ab5ea9c1ad7f6e3b7fdc7a9c3e"></a><!-- doxytag: member="ip_frag.c::PACK_STRUCT_STRUCT" ref="a421562ab5ea9c1ad7f6e3b7fdc7a9c3e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PACK_STRUCT_BEGIN struct <a class="el" href="structetharp__hdr.html">etharp_hdr</a> <a class="el" href="ip__frag_8c.html#a421562ab5ea9c1ad7f6e3b7fdc7a9c3e">PACK_STRUCT_STRUCT</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This is a helper struct which holds the starting offset and the ending offset of this fragment to easily chain the fragments. It has to be packed since it has to fit inside the IP header.</p>
<p>the ARP message </p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
