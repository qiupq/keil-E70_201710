<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SAME70 Xplained Software Package: libraries/liblwip/source/lwip_1.3.2/src/netif/etharp.c File Reference</title>
<link href="common/style.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
    <div id="body">
        <div id="title">  SAME70 Xplained Software Package 1.5</div>
        <div id="banner"></div>

<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="dir_81818f1c1b01098ad6d8389f2aaf9f72.html">libraries</a>      </li>
      <li><a class="el" href="dir_f9d6af8b0767ec29e003eb404f55b2ba.html">liblwip</a>      </li>
      <li><a class="el" href="dir_a4b90551bcebf72d44580c734ab11c86.html">source</a>      </li>
      <li><a class="el" href="dir_7fff4700eae15a55204f316974611e6c.html">lwip_1.3.2</a>      </li>
      <li><a class="el" href="dir_6c5a4da2b38a7354841e985f92489e70.html">src</a>      </li>
      <li><a class="el" href="dir_0845ffa000839a64dbb760a8cead011c.html">netif</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<h1>etharp.c File Reference</h1>  </div>
</div>
<div class="contents">
<code>#include &quot;<a class="el" href="opt_8h_source.html">lwip/opt.h</a>&quot;</code><br/>
<code>#include &quot;lwip/inet.h&quot;</code><br/>
<code>#include &quot;lwip/ip.h&quot;</code><br/>
<code>#include &quot;lwip/stats.h&quot;</code><br/>
<code>#include &quot;lwip/snmp.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="dhcp_8h_source.html">lwip/dhcp.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="autoip_8h_source.html">lwip/autoip.h</a>&quot;</code><br/>
<code>#include &quot;netif/etharp.h&quot;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>

<p><a href="etharp_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structetharp__entry.html">etharp_entry</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="etharp_8c.html#a741a0710dc126ed3ae9e305472df3432">ARP_MAXAGE</a>&nbsp;&nbsp;&nbsp;240</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="etharp_8c.html#a0a03fea13e060da5a53a10a75a96def9">ARP_MAXPENDING</a>&nbsp;&nbsp;&nbsp;2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a28a28d3e575df3e75985e2313cc2d51a"></a><!-- doxytag: member="etharp.c::HWTYPE_ETHERNET" ref="a28a28d3e575df3e75985e2313cc2d51a" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>HWTYPE_ETHERNET</b>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a06faf2eae13476a702524b13ea6ecd7f"></a><!-- doxytag: member="etharp.c::ARPH_HWLEN" ref="a06faf2eae13476a702524b13ea6ecd7f" args="(hdr)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>ARPH_HWLEN</b>(hdr)&nbsp;&nbsp;&nbsp;(ntohs((hdr)-&gt;_hwlen_protolen) &gt;&gt; 8)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8c416438814934662a28d7e3c891a175"></a><!-- doxytag: member="etharp.c::ARPH_PROTOLEN" ref="a8c416438814934662a28d7e3c891a175" args="(hdr)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>ARPH_PROTOLEN</b>(hdr)&nbsp;&nbsp;&nbsp;(ntohs((hdr)-&gt;_hwlen_protolen) &amp; 0xff)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af463dc7a7aaf3ea0b6bc472b261380ac"></a><!-- doxytag: member="etharp.c::ARPH_HWLEN_SET" ref="af463dc7a7aaf3ea0b6bc472b261380ac" args="(hdr, len)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>ARPH_HWLEN_SET</b>(hdr, len)&nbsp;&nbsp;&nbsp;(hdr)-&gt;_hwlen_protolen = htons(ARPH_PROTOLEN(hdr) | ((len) &lt;&lt; 8))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aedb2ded9225b09da0358754f859d72d6"></a><!-- doxytag: member="etharp.c::ARPH_PROTOLEN_SET" ref="aedb2ded9225b09da0358754f859d72d6" args="(hdr, len)" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>ARPH_PROTOLEN_SET</b>(hdr, len)&nbsp;&nbsp;&nbsp;(hdr)-&gt;_hwlen_protolen = htons((len) | (ARPH_HWLEN(hdr) &lt;&lt; 8))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="etharp_8c.html#ab0dcd958805ed20ff8b2b804f6f10f3f">ETHARP_TRY_HARD</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6a844fd111f8839de84f99e9fbe36cf7"></a><!-- doxytag: member="etharp.c::ETHARP_FIND_ONLY" ref="a6a844fd111f8839de84f99e9fbe36cf7" args="" -->
#define&nbsp;</td><td class="memItemRight" valign="bottom"><b>ETHARP_FIND_ONLY</b>&nbsp;&nbsp;&nbsp;2</td></tr>
<tr><td colspan="2"><h2><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><b>etharp_state</b> { <b>ETHARP_STATE_EMPTY</b> =  0, 
<b>ETHARP_STATE_PENDING</b>, 
<b>ETHARP_STATE_STABLE</b>
 }</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="etharp_8c.html#a654f4dad71f7e2bc4820094648f37a26">etharp_tmr</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">s8_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="etharp_8c.html#ac66020c18fb961891bd21532f04dc447">etharp_find_addr</a> (struct <a class="el" href="structnetif.html">netif</a> *<a class="el" href="structnetif.html">netif</a>, struct <a class="el" href="structip__addr.html">ip_addr</a> *ipaddr, struct <a class="el" href="structeth__addr.html">eth_addr</a> **eth_ret, struct <a class="el" href="structip__addr.html">ip_addr</a> **ip_ret)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="etharp_8c.html#a5869fcbe01d053ccef738ca3d1566de1">etharp_ip_input</a> (struct <a class="el" href="structnetif.html">netif</a> *<a class="el" href="structnetif.html">netif</a>, struct <a class="el" href="structpbuf.html">pbuf</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="etharp_8c.html#aa40d84bf7334532d6a1aadd4b0113342">etharp_arp_input</a> (struct <a class="el" href="structnetif.html">netif</a> *<a class="el" href="structnetif.html">netif</a>, struct <a class="el" href="structeth__addr.html">eth_addr</a> *ethaddr, struct <a class="el" href="structpbuf.html">pbuf</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">err_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="etharp_8c.html#a7a81f45861388a3a73d81ee79a4c2902">etharp_output</a> (struct <a class="el" href="structnetif.html">netif</a> *<a class="el" href="structnetif.html">netif</a>, struct <a class="el" href="structpbuf.html">pbuf</a> *q, struct <a class="el" href="structip__addr.html">ip_addr</a> *ipaddr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">err_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="etharp_8c.html#a2c5a80e66f12cf403a426d5bcfdfe62f">etharp_query</a> (struct <a class="el" href="structnetif.html">netif</a> *<a class="el" href="structnetif.html">netif</a>, struct <a class="el" href="structip__addr.html">ip_addr</a> *ipaddr, struct <a class="el" href="structpbuf.html">pbuf</a> *q)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">err_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="etharp_8c.html#ad6bd761fba53b2aaa0348a4a6970d0c5">etharp_request</a> (struct <a class="el" href="structnetif.html">netif</a> *<a class="el" href="structnetif.html">netif</a>, struct <a class="el" href="structip__addr.html">ip_addr</a> *ipaddr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">err_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="etharp_8c.html#a6a10c58b82c56d02c48b3cfa2c2494ff">ethernet_input</a> (struct <a class="el" href="structpbuf.html">pbuf</a> *p, struct <a class="el" href="structnetif.html">netif</a> *<a class="el" href="structnetif.html">netif</a>)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6aac26114a085a1a287b32941ecd009e"></a><!-- doxytag: member="etharp.c::ethbroadcast" ref="a6aac26114a085a1a287b32941ecd009e" args="" -->
struct <a class="el" href="structeth__addr.html">eth_addr</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>ethbroadcast</b> = {{0xff,0xff,0xff,0xff,0xff,0xff}}</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ada3f27bb57d4e81b6d61203cc36ccd74"></a><!-- doxytag: member="etharp.c::ethzero" ref="ada3f27bb57d4e81b6d61203cc36ccd74" args="" -->
struct <a class="el" href="structeth__addr.html">eth_addr</a>&nbsp;</td><td class="memItemRight" valign="bottom"><b>ethzero</b> = {{0,0,0,0,0,0}}</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Address Resolution Protocol module for IP over Ethernet</p>
<p>Functionally, ARP is divided into two parts. The first maps an IP address to a physical address when sending a packet, and the second part answers requests from other machines for our physical address.</p>
<p>This implementation complies with RFC 826 (Ethernet ARP). It supports Gratuitious ARP from RFC3220 (IP Mobility Support for IPv4) section 4.6 if an interface calls etharp_gratuitous(our_netif) upon address change. </p>

<p>Definition in file <a class="el" href="etharp_8c_source.html">etharp.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a741a0710dc126ed3ae9e305472df3432"></a><!-- doxytag: member="etharp.c::ARP_MAXAGE" ref="a741a0710dc126ed3ae9e305472df3432" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ARP_MAXAGE&nbsp;&nbsp;&nbsp;240</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>the time an ARP entry stays valid after its last update, for ARP_TMR_INTERVAL = 5000, this is (240 * 5) seconds = 20 minutes. </p>

<p>Definition at line <a class="el" href="etharp_8c_source.html#l00068">68</a> of file <a class="el" href="etharp_8c_source.html">etharp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0a03fea13e060da5a53a10a75a96def9"></a><!-- doxytag: member="etharp.c::ARP_MAXPENDING" ref="a0a03fea13e060da5a53a10a75a96def9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ARP_MAXPENDING&nbsp;&nbsp;&nbsp;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>the time an ARP entry stays pending after first request, for ARP_TMR_INTERVAL = 5000, this is (2 * 5) seconds = 10 seconds. </p>

<p>Definition at line <a class="el" href="etharp_8c_source.html#l00076">76</a> of file <a class="el" href="etharp_8c_source.html">etharp.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab0dcd958805ed20ff8b2b804f6f10f3f"></a><!-- doxytag: member="etharp.c::ETHARP_TRY_HARD" ref="ab0dcd958805ed20ff8b2b804f6f10f3f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ETHARP_TRY_HARD&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Try hard to create a new entry - we want the IP address to appear in the cache (even if this means removing an active entry or so). </p>

<p>Definition at line <a class="el" href="etharp_8c_source.html#l00116">116</a> of file <a class="el" href="etharp_8c_source.html">etharp.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aa40d84bf7334532d6a1aadd4b0113342"></a><!-- doxytag: member="etharp.c::etharp_arp_input" ref="aa40d84bf7334532d6a1aadd4b0113342" args="(struct netif *netif, struct eth_addr *ethaddr, struct pbuf *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void etharp_arp_input </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnetif.html">netif</a> *&nbsp;</td>
          <td class="paramname"> <em>netif</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structeth__addr.html">eth_addr</a> *&nbsp;</td>
          <td class="paramname"> <em>ethaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Responds to ARP requests to us. Upon ARP replies to us, add entry to cache send out queued IP packets. Updates cache with snooped address pairs.</p>
<p>Should be called for incoming ARP packets. The pbuf in the argument is freed by this function.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>netif</em>&nbsp;</td><td>The lwIP network interface on which the ARP packet pbuf arrived. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ethaddr</em>&nbsp;</td><td>Ethernet address of netif. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>p</em>&nbsp;</td><td>The ARP packet that arrived on netif. Is freed by this function.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>NULL</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="pbuf_8c.html#ab0dd696fb4b6bc65e548944584f1738b">pbuf_free()</a> </dd></dl>

<p>Definition at line <a class="el" href="etharp_8c_source.html#l00625">625</a> of file <a class="el" href="etharp_8c_source.html">etharp.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="etharp_8c_aa40d84bf7334532d6a1aadd4b0113342_cgraph.gif" border="0" usemap="#etharp_8c_aa40d84bf7334532d6a1aadd4b0113342_cgraph" alt=""/></div>
<map name="etharp_8c_aa40d84bf7334532d6a1aadd4b0113342_cgraph" id="etharp_8c_aa40d84bf7334532d6a1aadd4b0113342_cgraph">
<area shape="rect" id="node3" href="group__uipconvfunc.html#gaa22b04cac8cf283ca12f028578bebc06" title="htons" alt="" coords="216,5,277,37"/><area shape="rect" id="node5" href="pbuf_8c.html#ab0dd696fb4b6bc65e548944584f1738b" title="pbuf_free" alt="" coords="201,61,292,93"/><area shape="rect" id="node7" href="mem_8c.html#a65169147c44e9db60d997819af9b455c" title="mem_free" alt="" coords="347,33,440,65"/><area shape="rect" id="node9" href="memp_8c.html#aecd94926b7c2a0e23ae195f4ae97581f" title="memp_free" alt="" coords="341,89,445,121"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac66020c18fb961891bd21532f04dc447"></a><!-- doxytag: member="etharp.c::etharp_find_addr" ref="ac66020c18fb961891bd21532f04dc447" args="(struct netif *netif, struct ip_addr *ipaddr, struct eth_addr **eth_ret, struct ip_addr **ip_ret)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">s8_t etharp_find_addr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnetif.html">netif</a> *&nbsp;</td>
          <td class="paramname"> <em>netif</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structip__addr.html">ip_addr</a> *&nbsp;</td>
          <td class="paramname"> <em>ipaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structeth__addr.html">eth_addr</a> **&nbsp;</td>
          <td class="paramname"> <em>eth_ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structip__addr.html">ip_addr</a> **&nbsp;</td>
          <td class="paramname"> <em>ip_ret</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Finds (stable) ethernet/IP address pair from ARP table using interface and IP address index. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>the addresses in the ARP table are in network order!</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>netif</em>&nbsp;</td><td>points to interface index </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ipaddr</em>&nbsp;</td><td>points to the (network order) IP address index </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>eth_ret</em>&nbsp;</td><td>points to return pointer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ip_ret</em>&nbsp;</td><td>points to return pointer </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>table index if found, -1 otherwise </dd></dl>

<p>Definition at line <a class="el" href="etharp_8c_source.html#l00544">544</a> of file <a class="el" href="etharp_8c_source.html">etharp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5869fcbe01d053ccef738ca3d1566de1"></a><!-- doxytag: member="etharp.c::etharp_ip_input" ref="a5869fcbe01d053ccef738ca3d1566de1" args="(struct netif *netif, struct pbuf *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void etharp_ip_input </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnetif.html">netif</a> *&nbsp;</td>
          <td class="paramname"> <em>netif</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Updates the ARP table using the given IP packet.</p>
<p>Uses the incoming IP packet's source address to update the ARP cache for the local network. The function does not alter or free the packet. This function must be called before the packet p is passed to the IP layer.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>netif</em>&nbsp;</td><td>The lwIP network interface on which the IP packet pbuf arrived. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>p</em>&nbsp;</td><td>The IP packet that arrived on netif.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>NULL</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="pbuf_8c.html#ab0dd696fb4b6bc65e548944584f1738b">pbuf_free()</a> </dd></dl>

<p>Definition at line <a class="el" href="etharp_8c_source.html#l00580">580</a> of file <a class="el" href="etharp_8c_source.html">etharp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7a81f45861388a3a73d81ee79a4c2902"></a><!-- doxytag: member="etharp.c::etharp_output" ref="a7a81f45861388a3a73d81ee79a4c2902" args="(struct netif *netif, struct pbuf *q, struct ip_addr *ipaddr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">err_t etharp_output </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnetif.html">netif</a> *&nbsp;</td>
          <td class="paramname"> <em>netif</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structip__addr.html">ip_addr</a> *&nbsp;</td>
          <td class="paramname"> <em>ipaddr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Resolve and fill-in Ethernet address header for outgoing IP packet.</p>
<p>For IP multicast and broadcast, corresponding Ethernet addresses are selected and the packet is transmitted on the link.</p>
<p>For unicast addresses, the packet is submitted to <a class="el" href="etharp_8c.html#a2c5a80e66f12cf403a426d5bcfdfe62f">etharp_query()</a>. In case the IP address is outside the local network, the IP address of the gateway is used.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>netif</em>&nbsp;</td><td>The lwIP network interface which the IP packet will be sent on. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>q</em>&nbsp;</td><td>The pbuf(s) containing the IP packet to be sent. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ipaddr</em>&nbsp;</td><td>The IP address of the packet destination.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><ul>
<li>ERR_RTE No route to destination (no gateway to external networks), or the return type of either <a class="el" href="etharp_8c.html#a2c5a80e66f12cf403a426d5bcfdfe62f">etharp_query()</a> or etharp_send_ip(). </li>
</ul>
</dd></dl>

<p>Definition at line <a class="el" href="etharp_8c_source.html#l00801">801</a> of file <a class="el" href="etharp_8c_source.html">etharp.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="etharp_8c_a7a81f45861388a3a73d81ee79a4c2902_cgraph.gif" border="0" usemap="#etharp_8c_a7a81f45861388a3a73d81ee79a4c2902_cgraph" alt=""/></div>
<map name="etharp_8c_a7a81f45861388a3a73d81ee79a4c2902_cgraph" id="etharp_8c_a7a81f45861388a3a73d81ee79a4c2902_cgraph">
<area shape="rect" id="node3" href="etharp_8c.html#a2c5a80e66f12cf403a426d5bcfdfe62f" title="etharp_query" alt="" coords="177,141,295,173"/><area shape="rect" id="node7" href="ip__addr_8c.html#a838a131d0fe258d1394fa2ce78e4c546" title="ip_addr_isbroadcast" alt="" coords="344,5,515,37"/><area shape="rect" id="node22" href="pbuf_8c.html#a0f81deff4a0e6e8e0ff161a7b9871449" title="pbuf_header" alt="" coords="179,197,293,229"/><area shape="rect" id="node5" href="etharp_8c.html#ad6bd761fba53b2aaa0348a4a6970d0c5" title="etharp_request" alt="" coords="364,61,495,93"/><area shape="rect" id="node9" href="memp_8c.html#a2b00593d086313c267b54a976bf67aa5" title="memp_malloc" alt="" coords="564,128,684,160"/><area shape="rect" id="node11" href="pbuf_8c.html#acfcb0a2af918658ba0afe36499c65f47" title="pbuf_alloc" alt="" coords="381,168,477,200"/><area shape="rect" id="node14" href="pbuf_8c.html#ab0dd696fb4b6bc65e548944584f1738b" title="pbuf_free" alt="" coords="579,196,669,228"/><area shape="rect" id="node16" href="pbuf_8c.html#aee9cfb728d91302f068b5c6bd581e3e5" title="pbuf_copy" alt="" coords="380,275,479,307"/><area shape="rect" id="node19" href="pbuf_8c.html#a77f6bbd69e45e542014d9c547c7da74e" title="pbuf_ref" alt="" coords="388,331,471,363"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2c5a80e66f12cf403a426d5bcfdfe62f"></a><!-- doxytag: member="etharp.c::etharp_query" ref="a2c5a80e66f12cf403a426d5bcfdfe62f" args="(struct netif *netif, struct ip_addr *ipaddr, struct pbuf *q)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">err_t etharp_query </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnetif.html">netif</a> *&nbsp;</td>
          <td class="paramname"> <em>netif</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structip__addr.html">ip_addr</a> *&nbsp;</td>
          <td class="paramname"> <em>ipaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="paramname"> <em>q</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Send an ARP request for the given IP address and/or queue a packet.</p>
<p>If the IP address was not yet in the cache, a pending ARP cache entry is added and an ARP request is sent for the given address. The packet is queued on this entry.</p>
<p>If the IP address was already pending in the cache, a new ARP request is sent for the given address. The packet is queued on this entry.</p>
<p>If the IP address was already stable in the cache, and a packet is given, it is directly sent and no ARP request is sent out.</p>
<p>If the IP address was already stable in the cache, and no packet is given, an ARP request is sent out.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>netif</em>&nbsp;</td><td>The lwIP network interface on which ipaddr must be queried for. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ipaddr</em>&nbsp;</td><td>The IP address to be resolved. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>q</em>&nbsp;</td><td>If non-NULL, a pbuf that must be delivered to the IP address. q is not freed by this function.</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>q must only be ONE packet, not a packet queue!</dd></dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><ul>
<li>ERR_BUF Could not make room for Ethernet header.</li>
<li>ERR_MEM Hardware address unknown, and no more ARP entries available to query for address or queue the packet.</li>
<li>ERR_MEM Could not queue packet due to memory shortage.</li>
<li>ERR_RTE No route to destination (no gateway to external networks).</li>
<li>ERR_ARG Non-unicast address given, those will not appear in ARP cache. </li>
</ul>
</dd></dl>

<p>Definition at line <a class="el" href="etharp_8c_source.html#l00892">892</a> of file <a class="el" href="etharp_8c_source.html">etharp.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="etharp_8c_a2c5a80e66f12cf403a426d5bcfdfe62f_cgraph.gif" border="0" usemap="#etharp_8c_a2c5a80e66f12cf403a426d5bcfdfe62f_cgraph" alt=""/></div>
<map name="etharp_8c_a2c5a80e66f12cf403a426d5bcfdfe62f_cgraph" id="etharp_8c_a2c5a80e66f12cf403a426d5bcfdfe62f_cgraph">
<area shape="rect" id="node3" href="etharp_8c.html#ad6bd761fba53b2aaa0348a4a6970d0c5" title="etharp_request" alt="" coords="193,5,324,37"/><area shape="rect" id="node5" href="ip__addr_8c.html#a838a131d0fe258d1394fa2ce78e4c546" title="ip_addr_isbroadcast" alt="" coords="173,61,344,93"/><area shape="rect" id="node7" href="memp_8c.html#a2b00593d086313c267b54a976bf67aa5" title="memp_malloc" alt="" coords="393,112,513,144"/><area shape="rect" id="node9" href="pbuf_8c.html#acfcb0a2af918658ba0afe36499c65f47" title="pbuf_alloc" alt="" coords="211,168,307,200"/><area shape="rect" id="node14" href="pbuf_8c.html#ab0dd696fb4b6bc65e548944584f1738b" title="pbuf_free" alt="" coords="408,224,499,256"/><area shape="rect" id="node16" href="pbuf_8c.html#aee9cfb728d91302f068b5c6bd581e3e5" title="pbuf_copy" alt="" coords="209,275,308,307"/><area shape="rect" id="node19" href="pbuf_8c.html#a77f6bbd69e45e542014d9c547c7da74e" title="pbuf_ref" alt="" coords="217,331,300,363"/><area shape="rect" id="node11" href="mem_8c.html#a932aa40d85b14cb7331625e012d12335" title="mem_malloc" alt="" coords="397,168,509,200"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad6bd761fba53b2aaa0348a4a6970d0c5"></a><!-- doxytag: member="etharp.c::etharp_request" ref="ad6bd761fba53b2aaa0348a4a6970d0c5" args="(struct netif *netif, struct ip_addr *ipaddr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">err_t etharp_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnetif.html">netif</a> *&nbsp;</td>
          <td class="paramname"> <em>netif</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structip__addr.html">ip_addr</a> *&nbsp;</td>
          <td class="paramname"> <em>ipaddr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Send an ARP request packet asking for ipaddr.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>netif</em>&nbsp;</td><td>the lwip network interface on which to send the request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ipaddr</em>&nbsp;</td><td>the IP address for which to ask </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>ERR_OK if the request has been sent ERR_MEM if the ARP packet couldn't be allocated any other err_t on failure </dd></dl>

<p>Definition at line <a class="el" href="etharp_8c_source.html#l01130">1130</a> of file <a class="el" href="etharp_8c_source.html">etharp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a654f4dad71f7e2bc4820094648f37a26"></a><!-- doxytag: member="etharp.c::etharp_tmr" ref="a654f4dad71f7e2bc4820094648f37a26" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void etharp_tmr </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Clears expired entries in the ARP table.</p>
<p>This function should be called every ETHARP_TMR_INTERVAL microseconds (5 seconds), in order to expire entries in the ARP table. </p>

<p>Definition at line <a class="el" href="etharp_8c_source.html#l00165">165</a> of file <a class="el" href="etharp_8c_source.html">etharp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6a10c58b82c56d02c48b3cfa2c2494ff"></a><!-- doxytag: member="etharp.c::ethernet_input" ref="a6a10c58b82c56d02c48b3cfa2c2494ff" args="(struct pbuf *p, struct netif *netif)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">err_t ethernet_input </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structnetif.html">netif</a> *&nbsp;</td>
          <td class="paramname"> <em>netif</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Process received ethernet frames. Using this function instead of directly calling ip_input and passing ARP frames through etharp in ethernetif_input, the ARP cache is protected from concurrent access.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>p</em>&nbsp;</td><td>the recevied packet, p-&gt;payload pointing to the ethernet header </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>netif</em>&nbsp;</td><td>the network interface on which the packet was received </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="etharp_8c_source.html#l01147">1147</a> of file <a class="el" href="etharp_8c_source.html">etharp.c</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="etharp_8c_a6a10c58b82c56d02c48b3cfa2c2494ff_cgraph.gif" border="0" usemap="#etharp_8c_a6a10c58b82c56d02c48b3cfa2c2494ff_cgraph" alt=""/></div>
<map name="etharp_8c_a6a10c58b82c56d02c48b3cfa2c2494ff_cgraph" id="etharp_8c_a6a10c58b82c56d02c48b3cfa2c2494ff_cgraph">
<area shape="rect" id="node3" href="etharp_8c.html#aa40d84bf7334532d6a1aadd4b0113342" title="etharp_arp_input" alt="" coords="364,48,508,80"/><area shape="rect" id="node5" href="group__uipconvfunc.html#gaa22b04cac8cf283ca12f028578bebc06" title="htons" alt="" coords="776,344,837,376"/><area shape="rect" id="node7" href="pbuf_8c.html#ab0dd696fb4b6bc65e548944584f1738b" title="pbuf_free" alt="" coords="597,208,688,240"/><area shape="rect" id="node9" href="etharp_8c.html#a5869fcbe01d053ccef738ca3d1566de1" title="etharp_ip_input" alt="" coords="180,693,313,725"/><area shape="rect" id="node12" href="ip_8c.html#a3c420dab0c6760df099a2d688fa42a26" title="ip_input" alt="" coords="208,418,285,450"/><area shape="rect" id="node23" href="pbuf_8c.html#a0f81deff4a0e6e8e0ff161a7b9871449" title="pbuf_header" alt="" coords="585,505,700,537"/><area shape="rect" id="node15" href="icmp_8c.html#ae26c59eab4ce553964a0c9d43f534d06" title="icmp_dest_unreach" alt="" coords="560,264,725,296"/><area shape="rect" id="node17" href="icmp_8c.html#ac929e48a1dddf98050b73a2633fcaef1" title="icmp_input" alt="" coords="385,586,487,618"/><area shape="rect" id="node20" href="ip__addr_8c.html#a838a131d0fe258d1394fa2ce78e4c546" title="ip_addr_isbroadcast" alt="" coords="557,612,728,644"/><area shape="rect" id="node26" href="ip__frag_8c.html#a5752d82db629e96aa78d42eb538dde71" title="ip_reass" alt="" coords="395,312,477,344"/><area shape="rect" id="node29" href="inet_8c.html#a4e817a3825f6d17c4e3a80614f65ac07" title="ntohs" alt="" coords="612,370,673,402"/><area shape="rect" id="node34" href="netif_8c.html#a27f5900eaf1a19d9ce2b7517d480b4d3" title="netif_is_up" alt="" coords="385,474,487,506"/><area shape="rect" id="node38" href="pbuf_8c.html#a50abfe830a33a1a47a562febee66015d" title="pbuf_realloc" alt="" coords="381,154,491,186"/><area shape="rect" id="node41" href="raw_8c.html#a71d8bc3eb865e3c68a2610f71587e13e" title="raw_input" alt="" coords="391,744,481,776"/><area shape="rect" id="node44" href="tcp__in_8c.html#ae70c3c99d9dd6b07f7e11f7ba5eedcb5" title="tcp_input" alt="" coords="392,530,480,562"/><area shape="rect" id="node50" href="udp_8c.html#a7b338a5515606bd51976fbc5bcec9611" title="udp_input" alt="" coords="389,418,483,450"/></map>
</div>
</p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
